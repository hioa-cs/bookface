# BACKUP AND RESTORE INSTRUCTIONS

This document explains how to use the `backup_db.py` and `restore_db.py` scripts for taking a backup of a CockroachDB database and restoring it later. Follow these steps carefully to ensure smooth operations.

---

## Prerequisites

Before using the backup or restore scripts, ensure that the following requirements are met:

### Install Required Python Packages and Binaries
Install the required Python packages using pip:

```bash
pip3 install psycopg2
apt-get install -y postgresql-client-common postgresql-client
```

### Set Up CockroachDB
Ensure CockroachDB is installed and running. If youâ€™re using insecure mode, make sure the cluster is configured accordingly.

To check if CockroachDB is running, use:

```bash
cockroach sql --insecure
```

---

## Using the Backup Script

The `backup_db.py` script allows you to take a backup of your CockroachDB database, including tables and images.

### Command Syntax

```bash
python3 backup_db.py [--output-dir <path_to_directory>]
```

### Arguments
- **`--output-dir` (optional):** Specify the directory where the backup should be saved. If not provided, the script will create a timestamped directory in the current working directory.

### Example Usage

1. Run the script without specifying a directory (creates a timestamped backup):

   ```bash
   python3 backup_db.py
   ```

2. Run the script and specify a backup directory:

   ```bash
   python3 backup_db.py --output-dir /path/to/backup
   ```

The script will:
- Create a folder (if not specified, a timestamped folder will be created).
- Export table data as JSON files.
- Save images to a dedicated `images/` folder inside the backup directory.
- Generate a `meta.json` file containing the schema and metadata of the database.

---

## Using the Restore Script

The `restore_db.py` script allows you to restore a database from a backup created by `backup_db.py`.

### Command Syntax

```bash
python3 restore_db.py --from-source <path_to_backup> [--restore-meta] [-v]
```

### Arguments
- **`--from-source` (required):** Specify the path to the backup directory.
- **`--restore-meta` (optional):** Recreate the database, users, and tables based on the metadata in the `meta.json` file.
- **`-v` or `--verbose` (optional):** Enable verbose logging for debugging.

### Example Usage

1. Restore only table data and images (without recreating database and tables):

   ```bash
   python3 restore_db.py --from-source /path/to/backup
   ```

2. Restore database, users, tables, and all data:

   ```bash
   python3 restore_db.py --from-source /path/to/backup --restore-meta
   ```

3. Restore with verbose logging enabled:

   ```bash
   python3 restore_db.py --from-source /path/to/backup --restore-meta -v
   ```

### Important Notes
- **Ensure the Backup Directory Exists:** The path specified in `--from-source` must be valid and contain the files generated by `backup_db.py`.
- **User Creation:** The `restore_meta` step automatically creates the user (if missing) and assigns privileges.

